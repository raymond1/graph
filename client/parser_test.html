<html>
<head>
<title>Test</title>
<meta charset="utf-8" /> 
</head>
<body>
  <div id="test">

  </div>
<script src='programming.js'></script>
<script src='strings.js'></script>
<script src='parser.js'></script>
<script src='debugger.js'></script>
<script>

//Treenode connects nodes with domElements
//A Treenode is not the node data it contains
//A Treenode is not the domElement that is clicked on
class TreeNode{
  constructor(node, domElement){
    this.node = node
    this.expanded = false
    let ul = document.createElement('ul')
    ul.style.border = '4px black solid'
    let li = document.createElement('li')
    li.innerHTML = 'type:' + this.node.type + ' id:' + this.node.id
    if (this.node.children.length > 0){
      li.addEventListener('click', this.expand.bind(li))
      li.treeNode = this
    }
    ul.appendChild(li)

    domElement.appendChild(ul)
  }
  
  expand(){
    //This refers to the li element that was clicked
    if (!this.treeNode.expanded){
      if (this.treeNode.node.type == 'pattern'){
        debugger
      }
      for (const childNode of this.treeNode.node.children) {
        new TreeNode(childNode, this)
      }
    }
    this.treeNode.expanded = true
  }
}

var grammar =
`
RULE_LIST = 
[
  'RULE',
  SEQUENCE
  [
    'RULE',
    ',',
    'RULE_LIST'
  ]
]
`
/*
`
RULE_LIST = 
[
  RULE,
  SEQUENCE
  [
    RULE,
    ',',
    RULE_LIST
  ]
]

RULE = SEQUENCE[
  WS_ALLOW_BOTH[RULE_NAME],
  '=',
  WS_ALLOW_BOTH[PATTERN]
]

PATTERN_LIST = [
PATTERN,
PATTERN, ',', PATTERN_LIST
]

PATTERN = OR[
  QUOTED_STRING,
  OR,
  SEQUENCE,
  RULE_NAME,
  WS_ALLOW_BOTH
]

QUOTED_STRING=
SEQUENCE[
  SEQUENCE[S_QUOTE, STRING, S_QUOTE]
]

OR = [
  SEQUENCE[L_SQUARE_BRACKET, PATTERN_LIST, R_SQUARE_BRACKET],
  SEQUENCE['OR', L_SQUARE_BRACKET, PATTERN_LIST, R_SQUARE_BRACKET]
]

SEQUENCE = SEQUENCE[
  'SEQUENCE', L_SQUARE_BRACKET, CONSTRUCT_LIST, R_SQUARE_BRACKET
]

STRING = OR[
SEQUENCE[STRING_CHARACTER,STRING],
STRING_CHARACTER
]

STRING_CHARACTER = OR[
  'A', 'B', 'C', 'D', 'E', 'F', 'G','H','I', 'J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',
  'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'
]

`
*/

//built-ins: WS_ALLOW_BOTH
//left and right angle brackets
//COMMA
//empty
Debugger.enabled = true
Debugger.mode = 'console'
var test_parser = new Parser(grammar)

//test_parser.parse()
//console.log('test')
tree = new TreeNode(test_parser.input_grammar, document.querySelector('#test'))

</script>
</body>
</html>
